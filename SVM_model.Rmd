---
title: "SVM_model"
author: "Ian Stewart"
date: "2025-05-01"
output: pdf_document
---

Steps of building model:

- train the model and tune

- test model based on tuned parameters

- calculate error and accuracy

```{r, include=FALSE}
library(e1071)
library(tidyverse)
```

#Load in your own paths
```{r}
train <- read.csv("C:\\Users\\galac\\Downloads\\train_fires10.csv")

test <- read.csv("C:\\Users\\galac\\Downloads\\test_fires10.csv")
```


#################################################################################################################

#If already Imputed don't run!!
```{r}
train <- train %>%
  mutate(across(where(is.character), as.factor),
         owner_code = as.factor(owner_code),
         discovery_hour = as.factor(discovery_hour),
         burn_time_seconds = log(1+burn_time_seconds),
         fire_size = log(fire_size))


test <- test %>%
  mutate(across(where(is.character), as.factor),
         owner_code = as.factor(owner_code),
         discovery_hour = as.factor(discovery_hour),
         burn_time_seconds = log(1+burn_time_seconds),
         fire_size = log(fire_size))


train <- train %>%
  mutate(burn_time_seconds = ifelse(burn_time_seconds == 0, NA, burn_time_seconds)) %>%
  group_by(fire_size_class) %>%
  mutate(burn_time_seconds = ifelse(is.na(burn_time_seconds), median(burn_time_seconds, na.rm = TRUE), burn_time_seconds)) %>%
  ungroup() %>% 
  select(-fire_size_class)

test <- test %>%
  mutate(burn_time_seconds = ifelse(burn_time_seconds == 0, NA, burn_time_seconds)) %>%
  group_by(fire_size_class) %>%
  mutate(burn_time_seconds = ifelse(is.na(burn_time_seconds), median(burn_time_seconds, na.rm = TRUE), burn_time_seconds)) %>%
  ungroup() %>% 
  select(-fire_size_class)

glimpse(train)
```
####################################################################################################################

#For this code under use the variables that have been transformed and are deemed important, NOTE: get rid of the train[1:1000, ] in the models so you can train and test on the wholeeeeee data

```{r}
set.seed(123)
```

```{r}

tune.out <- tune(svm, stat_cause_descr ~ ., data = train[1:1000,],
kernel = "radial",
ranges = list(
cost = c(0.1, 1, 10, 100, 1000),
gamma = c(0.5, 1, 2, 3, 4)
)
)

summary(tune.out)
```

#Used cost = 1 and gamma = 0.5 based on the step above but use whatever it outputs for the whole data

```{r}
svm_mod_best <- svm(stat_cause_descr ~ ., data = train[1:1000,], kernel = "radial",
cost = 1, gamma = 0.5)

pred <- predict(svm_mod_best, newdata = test[1:1000,])
table(pred, test[1:1000,]$stat_cause_descr)

mean(pred == test[1:1000,]$stat_cause_descr)
```

output:


Parameter tuning of ‘svm’:

- sampling method: 10-fold cross validation 

- best parameters:
 cost gamma
    1   0.5

- best performance: 0.565 

- Detailed performance results:
    cost gamma error dispersion
1  1e-01   0.5 0.768 0.04962078
2  1e+00   0.5 0.565 0.04143268
3  1e+01   0.5 0.576 0.05316641
4  1e+02   0.5 0.577 0.05250397
5  1e+03   0.5 0.578 0.05287301
6  1e-01   1.0 0.768 0.04962078
7  1e+00   1.0 0.690 0.04189935
8  1e+01   1.0 0.675 0.03472111
9  1e+02   1.0 0.674 0.03339993
10 1e+03   1.0 0.674 0.03098387
11 1e-01   2.0 0.768 0.04962078
12 1e+00   2.0 0.759 0.04629615
13 1e+01   2.0 0.756 0.04623611
14 1e+02   2.0 0.756 0.04623611
15 1e+03   2.0 0.756 0.04623611
16 1e-01   3.0 0.768 0.04962078
17 1e+00   3.0 0.762 0.04962078
18 1e+01   3.0 0.759 0.04629615
19 1e+02   3.0 0.759 0.04629615
20 1e+03   3.0 0.759 0.04629615
21 1e-01   4.0 0.768 0.04962078
22 1e+00   4.0 0.767 0.04945256
23 1e+01   4.0 0.761 0.04840799
24 1e+02   4.0 0.761 0.04840799
25 1e+03   4.0 0.761 0.04840799

> svm_mod_best <- svm(stat_cause_descr ~ ., data = train[1:1000,], kernel = "radial",
+ cost = 1, gamma = 0.5)

pred <- predict(svm_mod_best, newdata = test[1:1000,])
table(pred, test[1:1000,]$stat_cause_descr)

mean(pred == test[1:1000,]$stat_cause_descr)
> 
> pred <- predict(svm_mod_best, newdata = test[1:1000,])
> table(pred, test[1:1000,]$stat_cause_descr)
                   
pred                Arson Campfire Children Debris Burning Equipment Use
  Arson                47        3        4             37             6
  Campfire              0        0        0              0             0
  Children              0        0        0              0             0
  Debris Burning       35        2        8             99            10
  Equipment Use         0        0        0              1             0
  Fireworks             0        0        0              0             0
  Lightning            28       38        8             26            21
  Miscellaneous        29       13       14             40            21
  Missing/Undefined     0        0        0              0             0
  Powerline             0        0        0              0             0
  Railroad              0        0        0              0             0
  Smoking               0        0        0              0             0
  Structure             0        0        0              0             0
                   
pred                Fireworks Lightning Miscellaneous Missing/Undefined
  Arson                     1         5            17                 5
  Campfire                  0         0             0                 0
  Children                  0         0             0                 0
  Debris Burning            0         4            26                 6
  Equipment Use             0         0             0                 0
  Fireworks                 0         0             0                 0
  Lightning                 5       217            47                 5
  Miscellaneous             5        11            82                17
  Missing/Undefined         0         0             1                 6
  Powerline                 0         0             0                 0
  Railroad                  0         0             0                 0
  Smoking                   0         0             0                 0
  Structure                 0         0             0                 0
                   
pred                Powerline Railroad Smoking Structure
  Arson                     0        0       3         1
  Campfire                  0        0       0         0
  Children                  0        0       0         0
  Debris Burning            4        3       8         1
  Equipment Use             0        0       0         0
  Fireworks                 0        0       0         0
  Lightning                 3        3       4         3
  Miscellaneous             2        2      11         2
  Missing/Undefined         0        0       0         0
  Powerline                 0        0       0         0
  Railroad                  0        0       0         0
  Smoking                   0        0       0         0
  Structure                 0        0       0         0
> 
> mean(pred == test[1:1000,]$stat_cause_descr)
[1] 0.451
> 